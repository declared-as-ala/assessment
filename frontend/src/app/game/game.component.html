<div class="game-container container">
  <div class="game-header">
    <button class="btn-secondary" (click)="backToLobby()">‚Üê Back to Lobby</button>
    <h2>Game #{{ gameId() }}</h2>
    <button class="btn-danger" (click)="resignGame()">Resign</button>
  </div>

  @if (game()) {
    <div class="game-content">
      <div class="game-info card">
        <div class="player-section">
          <div class="player-info-box" [class.active]="game()!.currentTurn === 'BLACK'">
            <div class="player-avatar">{{ opponentName().charAt(0).toUpperCase() }}</div>
            <div>
              <div class="player-name">{{ opponentName() }}</div>
              <div class="player-label">{{ playerColor() === 'WHITE' ? 'Black' : 'White' }}</div>
            </div>
          </div>
        </div>

        <div class="board-wrapper">
          <app-chess-board
            [moves]="moves()"
            [playerColor]="playerColor()!"
            [isPlayerTurn]="isPlayerTurn()"
            (moveEmitter)="onMove($event)"
          ></app-chess-board>
        </div>

        <div class="player-section">
          <div class="player-info-box" [class.active]="game()!.currentTurn === playerColor()">
            <div class="player-avatar">{{ currentUser()!.displayName.charAt(0).toUpperCase() }}</div>
            <div>
              <div class="player-name">{{ currentUser()!.displayName }}</div>
              <div class="player-label">{{ playerColor() }} (You)</div>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar">
        <div class="card">
          <h3 class="mb-2">Game Status</h3>
          <div class="status-info">
            <div class="status-item">
              <span class="label">Turn:</span>
              <span class="value">{{ game()!.currentTurn }}</span>
            </div>
            <div class="status-item">
              <span class="label">Moves:</span>
              <span class="value">{{ game()!.moveCount }}</span>
            </div>
            <div class="status-item">
              <span class="label">Status:</span>
              <span class="value">{{ game()!.status }}</span>
            </div>
          </div>

          @if (isPlayerTurn()) {
            <div class="turn-indicator">
              <span class="status-dot"></span>
              Your turn
            </div>
          } @else {
            <div class="turn-indicator waiting">
              Waiting for opponent...
            </div>
          }
        </div>

        <app-move-list [moves]="moves()"></app-move-list>
      </div>
    </div>
  } @else {
    <div class="card">
      <div class="spinner"></div>
    </div>
  }

  <!-- Game End Modal -->
  @if (showGameEndModal()) {
    <div class="modal-overlay">
      <div class="modal card game-end-modal">
        <h2 class="modal-title">{{ gameEndMessage() }}</h2>
        <p class="modal-subtitle">
          @if (gameEndMessage()?.includes('won')) {
            <span>Your opponent resigned the game.</span>
          } @else {
            <span>Better luck next time!</span>
          }
        </p>
        <button class="btn-primary full-width" (click)="closeGameEndModal()">
          Back to Lobby
        </button>
      </div>
    </div>
  }
</div>


